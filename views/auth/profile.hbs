<div class="container-xxl flex-grow-1 container-p-y">
   <h4 class="fw-bold py-3 mb-4"><span class="text-muted fw-light">Account Settings /</span> Profile</h4>
   <div class="row">
      <div class="col-md-12">
         <ul class="nav nav-pills flex-column flex-md-row mb-3">
            <li class="nav-item">
               <a class="nav-link batikin-gradient" style="color: white;" href="../profile"><i class="bx bx-user me-1"></i> Profile</a>
            </li>
            <li class="nav-item">
               <a class="nav-link" href="../change_password"
                  ><i class="bx bx-key me-1"></i> Change Password</a
                  >
            </li>
         </ul>
         <div class="card mb-4">
            <h5 class="card-header">Profile Details</h5>
            <!-- Account -->
            <div class="card-body">
               <div class="d-flex align-items-start align-items-sm-center gap-4">
                  <img
                     src=""
                     alt="user-avatar"
                     class="d-block rounded"
                     height="100"
                     width="100"
                     id="profilePictureUploaded"
                     />
                  <div class="button-wrapper">
                     <label for="upload" class="btn btn-primary batikin-gradient me-2 mb-4" tabindex="0">
                     <span class="d-none d-sm-block">Upload new photo</span>
                     <i class="bx bx-upload d-block d-sm-none"></i>
                     <input 
                        type="file"
                        id="upload"
                        class="account-file-input"
                        hidden
                        accept="image/png, image/jpeg"
                        />
                     </label>
                     <button type="button" class="btn btn-outline-secondary account-image-reset mb-4">
                     <i class="bx bx-reset d-block d-sm-none"></i>
                     <span class="d-none d-sm-block">Reset</span>
                     </button>
                     <p class="text-muted mb-0">Allowed JPG, GIF or PNG. Max size of 800K</p>
                  </div>
               </div>
            </div>
            <hr class="my-0" />
            <div class="card-body">
               <form id="formAccountSettings" method="POST" onsubmit="return false">
                  <div class="row">
                     <div class="mb-3 col-md-6">
                        <label for="email" class="form-label">E-mail</label>
                        <input
                           class="form-control"
                           type="text"
                           id="email"
                           name="email"
                           value="john.doe@example.com"
                           placeholder="john.doe@example.com"
                           disabled="true"
                           />
                     </div>
                     <div class="mb-3 col-md-6">
                        <label for="organization" class="form-label">Role</label>
                        <input
                           type="text"
                           class="form-control"
                           id="role"
                           name="role"
                           value="ThemeSelection"
                           disabled="true"
                           />
                     </div>
                     <div class="mb-3 col-md-6">
                        <label for="firstName" class="form-label">Full Name</label>
                        <input
                           class="form-control"
                           type="text"
                           id="name"
                           name="name"
                           value="John"
                           autofocus
                           />
                     </div>
                  </div>
                  <div class="mt-2">
                     <button type="submit" class="btn btn-primary batikin-primary me-2">Save changes</button>
                     <button type="reset" class="btn btn-outline-secondary">Cancel</button>
                  </div>
               </form>
            </div>
            <!-- /Account -->
         </div>
      </div>
   </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
    $(document).ready(() => {
      cekAuth();
      fetchUserDetail();
    });
    const accessToken = localStorage.getItem('accessToken');
    const BACKEND_URL = 'https://backend.batikin.site';
    const DEFAULT_PROFILE = '../new_assets/img/avatars/default.png';
    const cekAuth = () => {
      $.ajax({
        url: '/verify',
        method: 'POST',
        data: {
          accessToken
        },
        dataType: 'JSON',
        success: (response) => {
          if(!response.data.isVerified) {
              localStorage.clear()
              window.location = '/logout'
          } else {
              const userdata = response.data.data;
              console.log('userdata : ', userdata);
              $('#nameLabel').html(userdata.name)
          }
        },
        error: (err) => {
          console.log(err)
          localStorage.clear()
          window.location = '/logout'
        }
      })
    }
    const fetchUserDetail = () => {
       $.ajax({
        url: `${BACKEND_URL}/api/user/detail`,
        method: 'GET',
        dataType: 'JSON',
        headers: {
          'Authorization': `Bearer ${accessToken}`
        },
        success: (response) => {
          console.log('Response ', response.data);
          const {email, name, role} = response.data;
          $('#name').val(name);
          $('#email').val(email);
          $('#role').val(role);

          let profile = response.data?.profile || DEFAULT_PROFILE;
          profile = profile === '' ? DEFAULT_PROFILE : profile;
          $('#profilePictureUploaded').attr('src', profile);

        },
        error: (err) => {
          console.log(err)
        }
       });
    }
</script>

            