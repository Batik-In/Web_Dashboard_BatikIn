<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="https://app.bitbybit.studio/favicon_black.ico">

    <title>nusaCRM - Dashboard</title>

	<!-- Vendors Style-->
	<link rel="stylesheet" href="css/vendors_css.css">

	<!-- Style-->
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/skin_color.css">
    <script src="https://kit.fontawesome.com/d5a9a38efa.js" crossorigin="anonymous"></script>
    <style>
        .theme-primary .customtab2 li a.nav-link:hover, .theme-primary .customtab2 li a.nav-link:active, .theme-primary .customtab2 li a.nav-link.active {
            background-color: #262627;
        }
        li.active.treeview > a {
            background: transparent;
            color: #262627 !important;
        }
        .theme-primary.light-skin .sidebar-menu > li.active.treeview > a {
            background: transparent;
            color: #262627 !important;
        }
        .theme-primary.light-skin .sidebar-menu > li.active .treeview-menu li.active a {
            color: #262627;
        }
        .theme-primary.light-skin .sidebar-menu > li.active a > i {
            color: #ffffff;
            background-color: #262627;
        }
        .theme-primary .customtab2 li a.nav-link:hover, .theme-primary .customtab2 li a.nav-link:active, .theme-primary .customtab2 li a.nav-link.active {
            background-color: #262627;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        .theme-primary .nav-tabs .nav-link.active {
            background-color: #262627;
            color: #ffffff;
        }
        .theme-primary .nav-tabs .nav-link.active:hover, .theme-primary .nav-tabs .nav-link.active:focus {
            border-bottom-color: #262627;
            background-color: #262627;
            color: #ffffff;
        }
    </style>
</head>

<body class="hold-transition light-skin sidebar-mini theme-primary fixed">

<div class="wrapper">
	<div id="loader"></div>

  <header class="main-header">
	<div class="d-flex align-items-center logo-box justify-content-start">
		<a href="#" class="waves-effect waves-light nav-link rounded d-none d-md-inline-block mx-10 push-btn" data-toggle="push-menu" role="button">
			<i class="fa fa-bars text-dark"></i>
		</a>
		<!-- Logo -->
		<a href="/home" class="logo justify-content-around">
		  <!-- logo-->
		  <div class="logo-lg">
			  <b style="font-size: 28px; color:#262627">nusaCRM</b>
		  </div>
		</a>
	</div>
    <!-- Header Navbar -->
    <nav class="navbar navbar-static-top">
	  <!-- Sidebar toggle button-->
	  <div class="app-menu">
		
	  </div>

	  <div class="navbar-custom-menu r-side">
		<ul class="nav navbar-nav">
			{{!-- <li class="btn-group nav-item d-lg-inline-flex d-none">
				<a href="#" data-provide="fullscreen" class="waves-effect waves-light nav-link rounded full-screen" title="Full Screen">
					<i class="fa fa-arrows-alt"></i>
			    </a>
			</li> --}}
           <!-- User Account-->
		  <li class="dropdown user user-menu">
			<a href="#" class="waves-effect waves-light rounded dropdown-toggle" data-bs-toggle="dropdown" title="User">
				<i class="fa fa-user"></i>
			</a>
			<ul class="dropdown-menu animated flipInX">
			  <li class="user-body">
				 <a id="logoutBtn" class="dropdown-item" href="#"><i class="fa fa-sign-out text-muted me-2"></i> Logout</a>
			  </li>
			</ul>
		  </li>

		</ul>
	  </div>
	</nav>
  </header>

  <aside class="main-sidebar">
    <!-- sidebar-->
    <section class="sidebar position-relative">
		<div class="user-profile px-10 py-15">
			<div class="d-flex align-items-center">
				<div class="image">
				  <img src="https://www.shareicon.net/data/2016/09/15/829466_man_512x512.png" class="avatar avatar-lg bg-primary-light" alt="User Image">
				</div>
				<div class="info ms-10">
					<p class="mb-0">Welcome</p>
					<h5 class="mb-0" id="nameLabel">Kairos Team</h5>
				</div>
			</div>
        </div>
	  	<div class="multinav">
		  <div class="multinav-scroll" style="height: 100%;">
			  <!-- sidebar menu-->
			  <ul class="sidebar-menu" data-widget="tree">
				<li class="treeview">
				  <a href="#">
				   <i class="fa fa-th-large"></i>
					<span>Dashboard</span>
					<span class="pull-right-container">
					  <i class="fa fa-angle-right pull-right"></i>
					</span>
				  </a>
				  <ul class="treeview-menu">
					<li><a href="/home"><i class="fa fa-table text-dark"></i>Template</a></li>
				  </ul>
				</li>
			  </ul>
		  </div>
		</div>
    </section>
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
	  <div class="container-full">
		<!-- Main content -->
		<section class="content">
			<div class="row">
                <!-- Table Section -->
                <div class="col-12">
                    <div class="box">
                      <div class="box-header with-border">
                        <h4 class="box-title" style="font-weight: 500;"> <span class="fa fa-whatsapp"></span> &nbsp;&nbsp; Template WA Official</h4>
                      </div>
                      <!-- /.box-header -->
                      <div class="box-body">
                          <!-- Nav tabs -->
                          <ul class="nav nav-tabs customtab2" role="tablist">
                              <li class="nav-item"> 
                                <a class="nav-link active" data-bs-toggle="tab" href="#tab_submitted" role="tab">
                                    <span class="hidden-sm-up">
                                        <i class="ion-home"></i>
                                    </span> 
                                    <span class="hidden-xs-down">Submitted</span> &nbsp;&nbsp;
                                    <span class="badge badge-pill badge-light"><b id="labelSubmitted">0</b></span> 
                                </a> 
                              </li>
                              <li class="nav-item"> 
                                <a class="nav-link" data-bs-toggle="tab" href="#tab_approved" role="tab">
                                    <span class="hidden-sm-up">
                                        <i class="ion-home"></i>
                                    </span> 
                                    <span class="hidden-xs-down">Approved</span> &nbsp;&nbsp;
                                    <span class="badge badge-pill badge-light"><b id="labelApproved">0</b></span> 
                                </a> 
                              </li>
                              <li class="nav-item"> 
                                <a class="nav-link" data-bs-toggle="tab" href="#tab_rejected" role="tab">
                                    <span class="hidden-sm-up">
                                        <i class="ion-home"></i>
                                    </span> 
                                    <span class="hidden-xs-down">Rejected</span> &nbsp;&nbsp;
                                    <span class="badge badge-pill badge-light"><b id="labelRejected">0</b></span> 
                                </a> 
                              </li>
                          </ul>
                          <!-- Tab panes -->
                          <div class="tab-content">
                              <div class="tab-pane active" id="tab_submitted" role="tabpanel">
                                  <br>
                                  <div class="table-responsive mt-5">
                                    <table class="table table-bordered mb-0">
                                        <thead>
                                            <tr>
                                                <th>Client</th>
                                                <th>Template Name</th>
                                                <th>Created At</th>
                                                <th>Updated At</th>
                                                <th>Status</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tableSubmitted"></tbody>
                                    </table>
                                  </div>
                              </div>
                              <div class="tab-pane" id="tab_approved" role="tabpanel">
                                  <br>
                                  <div class="table-responsive mt-5">
                                    <table class="table table-bordered mb-0">
                                        <thead>
                                            <tr>
                                                <th>Client</th>
                                                <th>Template Name</th>
                                                <th>Created At</th>
                                                <th>Updated At</th>
                                                <th>Status</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tableApproved"></tbody>
                                    </table>
                                  </div>
                              </div>
                              <div class="tab-pane" id="tab_rejected" role="tabpanel">
                                  <br>
                                  <div class="table-responsive mt-5">
                                    <table class="table table-bordered mb-0">
                                        <thead>
                                            <tr>
                                                <th>Client</th>
                                                <th>Template Name</th>
                                                <th>Created At</th>
                                                <th>Updated At</th>
                                                <th>Status</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tableRejected"></tbody>
                                    </table>
                                  </div>
                              </div>
                          </div>
                      </div>
                      <!-- /.box-body -->
                    </div>
                    <!-- /.box -->
                  </div>
			</div>
		</section>
		<!-- /.content -->
	  </div>
  </div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
	  &copy; 2022 <a href="https://nusacrm.com">nusaCRM</a>. All Rights Reserved.
  </footer>


  <!-- Add the sidebar's background. This div must be placed immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>

</div>
<!-- ./wrapper -->
<!-- Sidebar -->


<!-- Modal -->
{{#each data}}
<div class="modal center-modal fade" id="modal-detail-{{id}}" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="border-radius: 10px;">
        <div class="modal-header">
          <h4 class="modal-title"><b>Detail Template {{templateName}}</b></h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
           <div class="row">
               <div class="col-6">
                    <div class="form-group">
                        <label for="">Client Name</label>
                        <input type="text" name="clientName" value="{{client}}" class="form-control" readonly>
                    </div>
               </div>
               <div class="col-6">
                    <div class="form-group">
                        <label for="">Namespace</label>
                        <input type="text" name="namespace" value="{{namespace}}" class="form-control" readonly>
                    </div>
                </div>
               <div class="col-6">
                    <div class="form-group">
                        <label for="">Template Name</label>
                        <input type="text" name="templateName" value="{{templateName}}" class="form-control" readonly>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-group">
                        <label for="">Category</label>
                        <input type="text" name="clientName" value="{{category}}" class="form-control" readonly>
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-group">
                        <label for="">Language</label>
                        <input type="text" name="language" class="form-control" value="Indonesian" readonly>
                    </div>
               </div>

               <div class="col-12">
                    <b>Header</b>
                    <ul>
                        <li>Type : {{header.type}}</li>
                        <li>Message : {{header.message}}</li>
                        <li>Image Url : {{header.imageUrl}}</li>
                    </ul>  
                </div>

               <div class="col-12">
                   <b>Body</b>
                   <ul>
                       <li>Message : {{body.message}}</li>
                       <li>Sample Params : 
                          {{#each body.parameters}}
                               {{sample}} ,
                          {{/each}}
                       </li>
                   </ul>  
                </div>

                <div class="col-12">
                    <b>Footer</b>
                    <ul>
                        <li>Text : {{footer}}</li>
                    </ul>  
                 </div>

                 <div class="col-12">
                    <b>Buttons</b>
                    <ul>
                        <li>Button List : 
                          {{#each button.buttons}}
                              {{text}} ,
                          {{/each}}
                        </li>
                    </ul>  
                 </div>
               <!-- End -->
           </div>
        </div>
        <div class="modal-footer modal-footer-uniform">
            <button type="button" class="btn btn-light float-end" data-bs-dismiss="modal"><b>Close</b></button>
        </div>
      </div>    
    </div>
</div>
{{/each}}
<!-- /.modal -->

<!-- Modal -->
{{#each data}}
<div class="modal center-modal fade" id="modal-update-{{id}}" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content" style="border-radius: 10px;">
        <div class="modal-header">
          <h4 class="modal-title"><b>Update Status Template {{templateName}}</b></h4>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action="/template" method="post">
            <div class="form-group">
                <input type="hidden" name="id_template" id="id_template" value="{{id}}">
                <label class="form-label">Status</label>
                <select class="form-control select2" name="status_template" style="width: 100%;" required>
                  <option value="{{status}}" selected>{{status}}</option>
                  {{#ifCond status 'SUBMITTED'}}
                  <option value="APPROVED">APPROVED</option>
                  <option value="REJECTED">REJECTED</option>
                  {{/ifCond}}
                  {{#ifCond status 'APPROVED'}}
                  <option value="SUBMITTED">SUBMITTED</option>
                  <option value="REJECTED">REJECTED</option>
                  {{/ifCond}}
                  {{#ifCond status 'REJECTED'}}
                  <option value="SUBMITTED">SUBMITTED</option>
                  <option value="APPROVED">APPROVED</option>
                  {{/ifCond}}    
                </select>
              </div>
          
        </div>
        <div class="modal-footer modal-footer-uniform">
            <button type="submit" class="btn btn-primary float-end" style="background-color: #262627;">Save changes</button>
            <button type="button" class="btn btn-light float-end" data-bs-dismiss="modal"><b>Cancel</b></button>
        </div>
        </form>
      </div>
    </div>
</div>
{{/each}}
<!-- /.modal -->


	<!-- Vendor JS -->
	<script src="js/vendors.min.js"></script>
	<script src="js/pages/chat-popup.js"></script>
    <script src="../assets/icons/feather-icons/feather.min.js"></script>

	<script src="../assets/vendor_components/apexcharts-bundle/dist/apexcharts.js"></script>
	<script src="../assets/vendor_components/progressbar.js-master/dist/progressbar.js"></script>

	<!-- Florence Admin App -->
	<script src="js/template.js"></script>
	<script src="js/pages/dashboard.js"></script>
  <script src="https://kit.fontawesome.com/c3a6dded80.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@icon/themify-icons@1.0.1-alpha.3/themify-icons.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    $(document).ready(() => {
        cekAuth()
        getTemplates()
        $('#logoutBtn').click(() => {
            localStorage.clear()
            window.location = '/logout'
        })
    })
    const cekAuth = () => {
      const accessToken = localStorage.getItem('accessToken')
      $.ajax({
        url: '/verify',
        method: 'POST',
        data: {
          accessToken
        },
        dataType: 'JSON',
        success: (response) => {
          if(!response.data.isVerified) {
              localStorage.clear()
              window.location = '/logout'
          } else {
              const userdata = response.data.data
              $('#nameLabel').html(userdata.name)
          }
        },
        error: (err) => {
          console.log(err)
          localStorage.clear()
          window.location = '/logout'
        }
      })
    }
    const getTemplates = () => {
        $.ajax({
        url: '/template',
        method: 'GET',
        dataType: 'JSON',
        success: (response) => {
          const status = response.data.status
          const data = response.data.result
          for (let i = 0; i < status.length; i++) {
              updateLabel(status[i])
          }
          for (let i = 0; i < data.length; i++) {
              buildRow(data[i], i)
          }
        },
        error: (err) => {
          console.log(err)
        }
      })
    }
    const buildRow = (data, index) => {
      let statusContainer = ''
      let container =  $('#tableRejected')
      const submittedContainer = $('#tableSubmitted')
      const approvedContainer = $('#tableApproved')
      const rejectedContainer = $('#tableRejected')
      if(data.status == 'SUBMITTED') {
        container = submittedContainer
        statusContainer = '<div class="badge badge-warning-light badge-pill" style="color: black;"><b>Submitted</b></div>'
      } else if(data.status == 'APPROVED') {
        container = approvedContainer
        statusContainer = '<div class="badge badge-success-light badge-pill" style="color: black;"><b>Approved</b></div>'
      } else {
        container = rejectedContainer
        statusContainer = '<div class="badge badge-danger-light badge-pill" style="color: black;"><b>Rejected</b></div>'
      }
      const createdAtString = Date.parse(data.createdAt)
      const createdAt = new Date(createdAtString)
      const row = `<tr>                               
                    <td>${data.client}</td>
                    <td>${data.templateName}</td>
                    <td>${createdAt.getDate()}/${createdAt.getMonth()+1}/${createdAt.getFullYear()}</td>
                    <td>${data.updatedAt}</td>
                    <td>${statusContainer}</td>
                    <td>
                        <button data-bs-toggle="modal" data-bs-target="#modal-update-${data.id}" class="waves-effect waves-light btn-sm btn btn-danger mb-5">
                          Update Status
                        </button>
                        <button data-bs-toggle="modal" data-bs-target="#modal-detail-${data.id}" class="waves-effect waves-light btn-sm btn btn-dark mb-5">
                          Show Detail
                        </button>
                    </td>
                  </tr>`
      container.append(row)
    }

    const labelSubmitted = $('#labelSubmitted')
    const labelApproved = $('#labelApproved')
    const labelRejected = $('#labelRejected')

    const updateLabel = (data) => {
        if(data.label == 'SUBMITTED') {
          labelSubmitted.html(data.count)
        } else if(data.label == 'APPROVED') {
          labelApproved.html(data.count)
        } else {
          labelRejected.html(data.count)
        }
    }
  </script>
</body>
</html>